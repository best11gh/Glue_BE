<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MainCarousel API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea, button {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input[type="text"], input[type="number"], select, textarea {
            width: 300px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            padding: 10px 20px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .delete-btn {
            background: #dc3545;
        }
        .delete-btn:hover {
            background: #c82333;
        }
        .deploy-btn {
            background: #28a745;
        }
        .deploy-btn:hover {
            background: #218838;
        }
        textarea {
            width: 100%;
            height: 120px;
            font-family: monospace;
        }
        .carousel-item {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .carousel-image {
            max-width: 200px;
            max-height: 150px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .deploy-status {
            background: #e7f3ff;
            border: 2px solid #007bff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .deploy-status.active {
            background: #d4edda;
            border-color: #28a745;
        }
        @media (max-width: 768px) {
            .grid, .grid-three {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<h1>ğŸ  MainCarousel API Test (with Deploy Version Management)</h1>

<!-- 0. ë°°í¬ ë²„ì „ ê´€ë¦¬ ì„¹ì…˜ -->
<div class="section">
    <h2>ğŸš€ ë°°í¬ ë²„ì „ ê´€ë¦¬ (ê´€ë¦¬ì)</h2>
    <div id="currentDeployStatus" class="deploy-status"></div>

    <div class="grid">
        <div>
            <h3>í˜„ì¬ ë°°í¬ ë²„ì „ í™•ì¸</h3>
            <button onclick="loadCurrentDeployVersion()" class="deploy-btn">ğŸ” í˜„ì¬ ë°°í¬ ë²„ì „ ì¡°íšŒ</button>
            <div id="deployStatusDisplay"></div>
        </div>

        <div>
            <h3>ìƒˆ ë°°í¬ ë²„ì „ ì„¤ì •</h3>
            <div class="form-group">
                <label>ë°°í¬í•  ë²„ì „:</label>
                <select id="deployVersionSelect" style="width: 200px;">
                    <option value="">ë²„ì „ì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
            <div class="form-group">
                <label>ë°°í¬ ì„¤ëª…:</label>
                <input type="text" id="deployDescription" placeholder="ë°°í¬ ì„¤ëª… (ì„ íƒì‚¬í•­)">
            </div>
            <button onclick="setDeployVersion()" class="deploy-btn" id="deployBtn">ğŸš€ ë°°í¬ ë²„ì „ ì„¤ì •</button>
            <div id="deploySetStatus"></div>
        </div>
    </div>
</div>

<!-- 1. ì¡°íšŒ ì„¹ì…˜ -->
<div class="section">
    <h2>ğŸ“‹ 1. ìºëŸ¬ì…€ ì¡°íšŒ</h2>
    <div class="form-group">
        <label>Version (ì„ íƒì‚¬í•­):</label>
        <select id="queryVersion" style="width: 200px;">
            <option value="">í˜„ì¬ ë°°í¬ ë²„ì „ ìë™ ì¡°íšŒ</option>
        </select>
        <button onclick="loadVersions()">ğŸ”„ ë²„ì „ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
        <button onclick="loadCarousels()">ì¡°íšŒ</button>
    </div>
    <div id="versionStatus"></div>
    <div id="bulkDeleteStatus"></div>
    <div id="carouselList"></div>
</div>

<!-- 2. ë“±ë¡ ì„¹ì…˜ -->
<div class="section">
    <h2>â• 2. ìºëŸ¬ì…€ ë“±ë¡</h2>
    <div class="form-group">
        <label>Version:</label>
        <select id="createVersion" style="width: 200px;">
            <option value="">ê¸°ì¡´ ë²„ì „ ì„ íƒ</option>
        </select>
        <input type="text" id="createVersionInput" placeholder="ìƒˆ ë²„ì „ ì§ì ‘ ì…ë ¥ (ì˜ˆ: v2.0)" style="width: 200px; margin-left: 10px;">
    </div>
    <div class="form-group">
        <label>Description:</label>
        <input type="text" id="createDescription" placeholder="ì´ë¯¸ì§€ ì„¤ëª…">
    </div>
    <div class="form-group">
        <label>ì´ë¯¸ì§€ íŒŒì¼:</label>
        <input type="file" id="createImageInput" accept="image/*">
    </div>
    <p style="font-size: 12px; color: #666; margin: 5px 0;">
        ğŸ’¡ ìˆœì„œëŠ” ìë™ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤ (í˜„ì¬ ë²„ì „ì˜ ë§ˆì§€ë§‰ + 1)
    </p>
    <button onclick="createCarousel()" id="createBtn">ë“±ë¡</button>
    <div id="createStatus"></div>
</div>

<!-- 5. ë¡œê·¸ ì„¹ì…˜ -->
<div class="section">
    <h2>ğŸ“ API ì‘ë‹µ ë¡œê·¸</h2>
    <textarea id="logArea" readonly placeholder="API ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
    <button onclick="clearLog()">ë¡œê·¸ í´ë¦¬ì–´</button>
</div>

<script>
    const API_BASE = 'http://localhost:8080/api/main/carousel';
    const logArea = document.getElementById('logArea');

    // ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
    function addLog(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        logArea.value += `[${timestamp}] ${message}\n`;
        logArea.scrollTop = logArea.scrollHeight;
        console.log(message);
    }

    // ë¡œê·¸ í´ë¦¬ì–´
    function clearLog() {
        logArea.value = '';
    }

    // ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
    function showStatus(elementId, message, type = 'info') {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="status ${type}">${message}</div>`;
        setTimeout(() => {
            element.innerHTML = '';
        }, 10000);
    }

    // 0. í˜„ì¬ ë°°í¬ ë²„ì „ ì¡°íšŒ
    async function loadCurrentDeployVersion() {
        try {
            addLog('í˜„ì¬ ë°°í¬ ë²„ì „ ì¡°íšŒ ì‹œì‘');
            const response = await fetch(`${API_BASE}/deploy-version`);

            if (response.ok) {
                const version = await response.text(); // String ì‘ë‹µì´ë¯€ë¡œ text()ë¡œ ë°›ìŒ
                await displayCurrentDeployVersionSimple(version);
                addLog(`í˜„ì¬ ë°°í¬ ë²„ì „: ${version}`, 'success');
            } else {
                throw new Error(`HTTP ${response.status}: ${await response.text()}`);
            }
        } catch (error) {
            addLog(`ë°°í¬ ë²„ì „ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
            showStatus('deployStatusDisplay', `âŒ ${error.message}`, 'error');

            // ë°°í¬ ë²„ì „ì´ ì—†ëŠ” ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€
            const container = document.getElementById('currentDeployStatus');
            container.className = 'deploy-status';
            container.innerHTML = `
                    <h3>âš ï¸ ë°°í¬ ë²„ì „ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</h3>
                    <p>ì•„ë˜ì—ì„œ ë°°í¬í•  ë²„ì „ì„ ì„ íƒí•˜ì—¬ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>
                `;
        }
    }

    // ê°„ë‹¨í•œ ë°°í¬ ë²„ì „ í‘œì‹œ (ë²„ì „ ë¬¸ìì—´ë§Œ ë°›ëŠ” ê²½ìš°)
    async function displayCurrentDeployVersionSimple(version) {
        try {
            // í•´ë‹¹ ë²„ì „ì˜ ìºëŸ¬ì…€ ì •ë³´ë¥¼ ì¡°íšŒí•´ì„œ ì¶”ê°€ ì •ë³´ í‘œì‹œ
            const carouselResponse = await fetch(`${API_BASE}?version=${version}`);
            if (carouselResponse.ok) {
                const data = await carouselResponse.json();
                displayCurrentDeployVersion({
                    version: version,
                    description: `í˜„ì¬ ë°°í¬ ë²„ì „ (ìë™ ì¡°íšŒ)`,
                    hasCarousels: data.totalCount > 0,
                    carouselCount: data.totalCount
                });
            } else {
                // ìºëŸ¬ì…€ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œ
                displayCurrentDeployVersion({
                    version: version,
                    description: `í˜„ì¬ ë°°í¬ ë²„ì „`,
                    hasCarousels: false,
                    carouselCount: 0
                });
            }
        } catch (error) {
            // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œ
            displayCurrentDeployVersion({
                version: version,
                description: `í˜„ì¬ ë°°í¬ ë²„ì „`,
                hasCarousels: false,
                carouselCount: 0
            });
        }
    }

    // í˜„ì¬ ë°°í¬ ë²„ì „ í‘œì‹œ
    function displayCurrentDeployVersion(data) {
        const container = document.getElementById('currentDeployStatus');
        const statusClass = data.hasCarousels ? 'active' : '';

        container.className = `deploy-status ${statusClass}`;
        container.innerHTML = `
                <h3>ğŸš€ í˜„ì¬ ë°°í¬ ì¤‘: ${data.version}</h3>
                <p><strong>ì„¤ëª…:</strong> ${data.description || 'ì—†ìŒ'}</p>
                <p><strong>ìºëŸ¬ì…€:</strong> ${data.carouselCount}ê°œ ${data.hasCarousels ? 'âœ…' : 'âŒ'}</p>
                <p><strong>ìƒíƒœ:</strong> ${data.hasCarousels ? 'ì •ìƒ ë°°í¬ ì¤‘' : 'ìºëŸ¬ì…€ ì—†ìŒ (ë°°í¬ ë¶ˆê°€)'}</p>
            `;

        const statusMessage = data.hasCarousels
            ? `í˜„ì¬ "${data.version}" ë²„ì „ì´ ë°°í¬ ì¤‘ì…ë‹ˆë‹¤. (${data.carouselCount}ê°œ ìºëŸ¬ì…€)`
            : `í˜„ì¬ "${data.version}" ë²„ì „ì´ ë°°í¬ ì¤‘ì´ì§€ë§Œ ìºëŸ¬ì…€ì´ ì—†ìŠµë‹ˆë‹¤.`;

        showStatus('deployStatusDisplay', statusMessage, data.hasCarousels ? 'success' : 'error');
    }

    // ë°°í¬ ë²„ì „ ì„¤ì •
    async function setDeployVersion() {
        const version = document.getElementById('deployVersionSelect').value;
        const description = document.getElementById('deployDescription').value;

        if (!version) {
            alert('ë°°í¬í•  ë²„ì „ì„ ì„ íƒí•˜ì„¸ìš”.');
            return;
        }

        const deployBtn = document.getElementById('deployBtn');
        deployBtn.disabled = true;

        try {
            addLog(`ë°°í¬ ë²„ì „ ì„¤ì • ì‹œì‘: ${version}`);
            showStatus('deploySetStatus', 'ë°°í¬ ë²„ì „ ì„¤ì • ì¤‘...', 'info');

            const requestBody = {
                version: version,
                description: description || null
            };

            const response = await fetch(`${API_BASE}/deploy-version`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`ë°°í¬ ì„¤ì • ì‹¤íŒ¨: HTTP ${response.status} - ${errorText}`);
            }

            const result = await response.json();
            addLog(`ë°°í¬ ë²„ì „ ì„¤ì • ì™„ë£Œ: ${result.version} (í™œì„±: ${result.isActive})`, 'success');
            showStatus('deploySetStatus', `âœ… "${result.version}" ë²„ì „ì´ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');

            // í¼ ì´ˆê¸°í™”
            document.getElementById('deployVersionSelect').value = '';
            document.getElementById('deployDescription').value = '';

            // í˜„ì¬ ë°°í¬ ë²„ì „ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => loadCurrentDeployVersion(), 1000);

        } catch (error) {
            addLog(`ë°°í¬ ë²„ì „ ì„¤ì • ì‹¤íŒ¨: ${error.message}`, 'error');
            showStatus('deploySetStatus', `âŒ ë°°í¬ ì‹¤íŒ¨: ${error.message}`, 'error');
        } finally {
            deployBtn.disabled = false;
        }
    }

    // 1. ë²„ì „ ëª©ë¡ ë¡œë“œ
    async function loadVersions() {
        try {
            addLog('ë²„ì „ ëª©ë¡ ì¡°íšŒ ì‹œì‘');
            const response = await fetch(`${API_BASE}/versions`);
            const data = await response.json();

            if (response.ok) {
                updateVersionDropdowns(data.versions);
                addLog(`ë²„ì „ ëª©ë¡ ì¡°íšŒ ì„±ê³µ: ${data.totalCount}ê°œ ë²„ì „`, 'success');
                showStatus('versionStatus', `ğŸ“‹ ì´ ${data.totalCount}ê°œ ë²„ì „ ë°œê²¬`, 'info');
            } else {
                throw new Error(`HTTP ${response.status}: ${JSON.stringify(data)}`);
            }
        } catch (error) {
            addLog(`ë²„ì „ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
            showStatus('versionStatus', `âŒ ë²„ì „ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
        }
    }

    // ë²„ì „ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
    function updateVersionDropdowns(versions) {
        const querySelect = document.getElementById('queryVersion');
        const createSelect = document.getElementById('createVersion');
        const deploySelect = document.getElementById('deployVersionSelect');

        // ì¡°íšŒìš© ë“œë¡­ë‹¤ìš´
        querySelect.innerHTML = '<option value="">í˜„ì¬ ë°°í¬ ë²„ì „ ìë™ ì¡°íšŒ</option>';
        versions.forEach(version => {
            querySelect.innerHTML += `<option value="${version}">${version}</option>`;
        });

        // ë“±ë¡ìš© ë“œë¡­ë‹¤ìš´
        createSelect.innerHTML = '<option value="">ê¸°ì¡´ ë²„ì „ ì„ íƒ</option>';
        versions.forEach(version => {
            createSelect.innerHTML += `<option value="${version}">${version}</option>`;
        });

        // ë°°í¬ìš© ë“œë¡­ë‹¤ìš´
        deploySelect.innerHTML = '<option value="">ë°°í¬í•  ë²„ì „ ì„ íƒ</option>';
        versions.forEach(version => {
            deploySelect.innerHTML += `<option value="${version}">${version}</option>`;
        });
    }

    // 2. ìºëŸ¬ì…€ ì¡°íšŒ
    async function loadCarousels() {
        const version = document.getElementById('queryVersion').value;
        // versionì´ ë¹„ì–´ìˆìœ¼ë©´ ë°°í¬ ë²„ì „ ìë™ ì¡°íšŒ

        try {
            const versionText = version || 'í˜„ì¬ ë°°í¬ ë²„ì „';
            addLog(`ìºëŸ¬ì…€ ì¡°íšŒ ì‹œì‘: ${versionText}`);

            const url = version ? `${API_BASE}?version=${version}` : API_BASE;
            const response = await fetch(url);
            const data = await response.json();

            if (response.ok) {
                displayCarousels(data);
                addLog(`ìºëŸ¬ì…€ ì¡°íšŒ ì„±ê³µ: ${data.version} ë²„ì „ ${data.totalCount}ê°œ`, 'success');
            } else {
                throw new Error(`HTTP ${response.status}: ${JSON.stringify(data)}`);
            }
        } catch (error) {
            addLog(`ìºëŸ¬ì…€ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
        }
    }

    // ìºëŸ¬ì…€ ëª©ë¡ í‘œì‹œ
    function displayCarousels(data) {
        const container = document.getElementById('carouselList');
        if (data.totalCount === 0) {
            container.innerHTML = `<p>ë²„ì „ "${data.version}"ì— ë“±ë¡ëœ ìºëŸ¬ì…€ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
            return;
        }

        let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>ì´ ${data.totalCount}ê°œì˜ ìºëŸ¬ì…€ (Version: ${data.version})</h3>
                    <button onclick="bulkDeleteCarousels('${data.version}')" class="delete-btn" style="font-size: 12px; padding: 5px 10px;">
                        ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ (${data.totalCount}ê°œ)
                    </button>
                </div>
            `;

        data.images.forEach(item => {
            html += `
                    <div class="carousel-item">
                        <strong>ID:</strong> ${item.id} |
                        <strong>Order:</strong> ${item.displayOrder} |
                        <strong>Description:</strong> ${item.description || 'ì—†ìŒ'}
                        <br>
                        <img src="${item.imageUrl}" alt="Carousel ${item.id}" class="carousel-image"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuydtOuvuOyngCDroZzrk5wg7Iuk7YyoPC90ZXh0Pjwvc3ZnPg=='">
                        <br>
                        <small>URL: ${item.imageUrl}</small>
                        <br>
                        <button class="delete-btn" onclick="deleteCarousel(${item.id})" style="font-size: 12px; padding: 3px 8px;">ì‚­ì œ</button>
                    </div>
                `;
        });
        container.innerHTML = html;
    }

    // 3. ìºëŸ¬ì…€ ë“±ë¡
    async function createCarousel() {
        const selectedVersion = document.getElementById('createVersion').value;
        const inputVersion = document.getElementById('createVersionInput').value;
        const version = inputVersion || selectedVersion;
        const description = document.getElementById('createDescription').value;
        const fileInput = document.getElementById('createImageInput');
        const file = fileInput.files[0];

        if (!version || !file) {
            alert('Versionê³¼ ì´ë¯¸ì§€ íŒŒì¼ì„ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }

        const createBtn = document.getElementById('createBtn');
        createBtn.disabled = true;

        try {
            addLog(`ìºëŸ¬ì…€ ë“±ë¡ ì‹œì‘: ${file.name} (ë²„ì „: ${version})`);
            showStatus('createStatus', 'ì—…ë¡œë“œ URL ìƒì„± ì¤‘...', 'info');

            const requestBody = {
                version: version,
                fileName: file.name,
                description: description
            };

            const presignResponse = await fetch(`${API_BASE}/presigned-url`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!presignResponse.ok) {
                const errorData = await presignResponse.json();
                throw new Error(`Presigned URL ìƒì„± ì‹¤íŒ¨: ${JSON.stringify(errorData)}`);
            }

            const { presignedUrl, publicUrl, carouselId } = await presignResponse.json();
            addLog(`Presigned URL ìƒì„± ì„±ê³µ: ID=${carouselId}`);

            showStatus('createStatus', 'S3ì— ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...', 'info');
            const uploadResponse = await fetch(presignedUrl, {
                method: 'PUT',
                headers: {
                    'Content-Type': file.type
                },
                body: file
            });

            if (!uploadResponse.ok) {
                throw new Error(`S3 ì—…ë¡œë“œ ì‹¤íŒ¨: ${uploadResponse.status}`);
            }

            addLog(`ìºëŸ¬ì…€ ë“±ë¡ ì™„ë£Œ: ID=${carouselId}`, 'success');
            showStatus('createStatus', `âœ… ë“±ë¡ ì™„ë£Œ! (ID: ${carouselId})`, 'success');

            // í¼ ì´ˆê¸°í™”
            document.getElementById('createDescription').value = '';
            document.getElementById('createVersionInput').value = '';
            fileInput.value = '';

            // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                loadVersions();
                loadCarousels();
            }, 1000);

        } catch (error) {
            addLog(`ìºëŸ¬ì…€ ë“±ë¡ ì‹¤íŒ¨: ${error.message}`, 'error');
            showStatus('createStatus', `âŒ ë“±ë¡ ì‹¤íŒ¨: ${error.message}`, 'error');
        } finally {
            createBtn.disabled = false;
        }
    }

    // 6. ë²„ì „ë³„ ì¼ê´„ ì‚­ì œ
    async function bulkDeleteCarousels(targetVersion) {
        const version = targetVersion || document.getElementById('queryVersion').value;
        if (!version) {
            alert('ì‚­ì œí•  ë²„ì „ì„ ì„ íƒí•˜ì„¸ìš”.');
            return;
        }

        const carouselList = document.getElementById('carouselList');
        const currentItems = carouselList.querySelectorAll('.carousel-item').length;

        let confirmMessage = `ì •ë§ë¡œ "${version}" ë²„ì „ì˜ ëª¨ë“  ìºëŸ¬ì…€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        if (currentItems > 0) {
            confirmMessage += `\n\ní˜„ì¬ ${currentItems}ê°œì˜ í•­ëª©ì´ ì‚­ì œë©ë‹ˆë‹¤.`;
        }
        confirmMessage += '\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!';

        if (!confirm(confirmMessage)) {
            return;
        }

        try {
            addLog(`ë²„ì „ë³„ ì¼ê´„ ì‚­ì œ ì‹œì‘: version=${version}`);
            showStatus('bulkDeleteStatus', 'ì¼ê´„ ì‚­ì œ ì§„í–‰ ì¤‘...', 'info');

            const response = await fetch(`${API_BASE}/version/${version}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                const errorData = await response.text();
                throw new Error(`ì¼ê´„ ì‚­ì œ ì‹¤íŒ¨: HTTP ${response.status} ${errorData}`);
            }

            const result = await response.json();

            if (result.totalCount === 0) {
                addLog(`ì¼ê´„ ì‚­ì œ ì™„ë£Œ: ì‚­ì œí•  í•­ëª©ì´ ì—†ì—ˆìŠµë‹ˆë‹¤.`, 'info');
                showStatus('bulkDeleteStatus', 'ì‚­ì œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
            } else if (result.allSuccess) {
                addLog(`ì¼ê´„ ì‚­ì œ ì™„ë£Œ: ${result.summary}`, 'success');
                showStatus('bulkDeleteStatus', `âœ… ${result.summary}`, 'success');
            } else {
                addLog(`ì¼ê´„ ì‚­ì œ ë¶€ë¶„ ì™„ë£Œ: ${result.summary}`, 'error');
                showStatus('bulkDeleteStatus', `âš ï¸ ${result.summary}`, 'error');
            }
        } catch (error) {
                addLog(`ìºëŸ¬ì…€ ì‚­ì œ ì‹¤íŒ¨: ${error.message}`, 'error');
                showStatus('deleteStatus', `âŒ ì‚­ì œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
    }
</script>